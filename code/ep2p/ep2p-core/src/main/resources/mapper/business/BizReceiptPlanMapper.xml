<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yscf.core.dao.business.BizReceiptPlanMapper" >
  <resultMap id="BaseResultMap" type="com.yscf.core.model.business.BizReceiptPlan" >
     <id column="PID" property="pid" jdbcType="VARCHAR" />
    <result column="rep_pla_pid" property="repPlaPid" jdbcType="VARCHAR" />
    <result column="borrow_id" property="borrowId" jdbcType="VARCHAR" />
    <result column="customer_id" property="customerId" jdbcType="VARCHAR" />
    <result column="receivable_hike" property="receivableHike" jdbcType="DECIMAL" />
    <result column="net_hike" property="netHike" jdbcType="DECIMAL" />
    <result column="net_hike_status" property="netHikeStatus" jdbcType="VARCHAR" />
    <result column="receivable_interest" property="receivableInterest" jdbcType="DECIMAL" />
    <result column="net_interest" property="netInterest" jdbcType="DECIMAL" />
    <result column="repaid_capital" property="repaidCapital" jdbcType="DECIMAL" />
    <result column="repaid_interest" property="repaidInterest" jdbcType="DECIMAL" />
    <result column="capital" property="capital" jdbcType="DECIMAL" />
    <result column="remaining_capital" property="remainingCapital" jdbcType="DECIMAL" />
    <result column="pay_rate" property="payRate" jdbcType="DECIMAL" />
    <result column="pay_amount" property="payAmount" jdbcType="DECIMAL" />
    <result column="management_cost" property="managementCost" jdbcType="DECIMAL" />
    <result column="receipt_status" property="receiptStatus" jdbcType="VARCHAR" />
    <result column="expireactual_time" property="expireactualTime" jdbcType="TIMESTAMP" />
    <result column="expire_time" property="expireTime" jdbcType="TIMESTAMP" />
    <result column="late_fee" property="lateFee" jdbcType="DECIMAL" />
    <result column="late_fee_calculate_time" property="lateFeeCalculateTime" jdbcType="TIMESTAMP" />
    <result column="pay_type" property="payType" jdbcType="VARCHAR" />
    <result column="pay_amount_time" property="payAmountTime" jdbcType="TIMESTAMP" />
    <result column="plan_index" property="planIndex" jdbcType="VARCHAR" />
    <result column="repaid_time" property="repaidTime" jdbcType="TIMESTAMP" />
    <result column="interest" property="interest" jdbcType="DECIMAL" />
    <result column="increase_interest" property="increaseInterest" jdbcType="DECIMAL" />
    <result column="interest_type" property="interestType" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="create_user" property="createUser" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="last_update_user" property="lastUpdateUser" jdbcType="VARCHAR" />
    <result column="last_update_time" property="lastUpdateTime" jdbcType="TIMESTAMP" />
    <result column="rec_pla_desc" property="recPlaDesc" jdbcType="VARCHAR" />
    <result column="version" property="version" jdbcType="VARCHAR" />
    <result column="is_vip" property="isVip" jdbcType="VARCHAR" />
    <result column="transfer_id" property="transferId" jdbcType="VARCHAR" />
    <result column="play_type" property="playType" jdbcType="VARCHAR" />
	<!-- 收款状态名称 -->    
    <result column="receiptStatusName" property="receiptStatusName" jdbcType="VARCHAR" />
    <result column="duein_TotalValue" property="dueinTotalValue" jdbcType="VARCHAR" />
    
  </resultMap>
  <!-- 前台项目明细VO -->
  <resultMap id="BizReceiptPlanVOResultMap" type="com.yscf.core.model.ptp.financial.BizReceiptPlanModel" >
    <id column="PID" property="pid" jdbcType="VARCHAR" />
    <result column="repPlaPid" property="repPlaPid" jdbcType="VARCHAR" />
    <result column="borrowId" property="borrowId" jdbcType="VARCHAR" />
    <result column="customerId" property="customerId" jdbcType="VARCHAR" />
    <result column="expireTime" property="expireTime" jdbcType="TIMESTAMP" />
    <result column="borrowCode" property="borrowCode" jdbcType="VARCHAR" />
    <result column="borrowName" property="borrowName" jdbcType="VARCHAR" />
    <result column="borrowType" property="borrowType" jdbcType="VARCHAR" />
    <result column="planIndex" property="planIndex" jdbcType="VARCHAR" />
    <result column="borDeadline" property="borDeadline" jdbcType="VARCHAR" />
    <result column="principalAndInterest" property="principalAndInterest" jdbcType="DECIMAL" />
    <result column="capital" property="capital" jdbcType="DECIMAL" />
    <result column="interest" property="interest" jdbcType="DECIMAL" />
    <result column="netHike" property="netHike" jdbcType="DECIMAL" />
    <result column="lateFee" property="lateFee" jdbcType="DECIMAL" />
    <result column="lateFeeDate" property="lateFeeDate" jdbcType="INTEGER" />
    <result column="returnedDate" property="returnedDate" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="receipt_status" property="receiptStatus" jdbcType="VARCHAR" />
    <result column="receipt_status_name" property="receiptStatusName" jdbcType="VARCHAR" />
    <result column="recPlaDesc" property="recPlaDesc" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="BaseResultMapInvest" type="com.yscf.core.model.reflect.InvestUser" >
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="money" property="money" jdbcType="VARCHAR" />
    <result column="yearRate" property="yearRate" jdbcType="VARCHAR" />
    <result column="capital" property="capital" jdbcType="VARCHAR" />
    <result column="interest" property="interest" jdbcType="VARCHAR" />
    <result column="totalMoney" property="totalMoney" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="BizReceiptPlanInfoVOResultMap" type="com.yscf.core.model.ptp.investment.BizReceiptPlanInfoModel" >
    <result column="brpId" property="brpId" jdbcType="VARCHAR" />
    <result column="borrowId" property="borrowId" jdbcType="VARCHAR" />
    <result column="customerId" property="customerId" jdbcType="VARCHAR" />
    <result column="borrowCode" property="borrowCode" jdbcType="VARCHAR" />
    <result column="borrowName" property="borrowName" jdbcType="VARCHAR" />
    <result column="customerName" property="customerName" jdbcType="VARCHAR" />
    <result column="planIndex" property="planIndex" jdbcType="VARCHAR" />
    <result column="borDeadline" property="borDeadline" jdbcType="VARCHAR" />
    <result column="phoneNo" property="phoneNo" jdbcType="VARCHAR" />
    <result column="expireTime" property="expireTime" jdbcType="TIMESTAMP" />
    <result column="repaymentType" property="repaymentType" jdbcType="VARCHAR" />
    <result column="repaymentTypeName" property="repaymentTypeName" jdbcType="VARCHAR" />
    <result column="benXi" property="benXi" jdbcType="DECIMAL" />
    <result column="capital" property="capital" jdbcType="DECIMAL" />
    <result column="liXi" property="liXi" jdbcType="DECIMAL" />
    <result column="jiaXi" property="jiaXi" jdbcType="DECIMAL" />
    <result column="lateFee" property="lateFee" jdbcType="DECIMAL" />
    <result column="lateDay" property="lateDay" jdbcType="VARCHAR" />
    <result column="transferCode" property="transferCode" jdbcType="VARCHAR" />
    <result column="transferId" property="transferId" jdbcType="VARCHAR" />
    <result column="recPlaDesc" property="recPlaDesc" jdbcType="VARCHAR" />
    <result column="receiptStatusName" property="receiptStatusName" jdbcType="VARCHAR" />
    <result column="receiptStatus" property="receiptStatus" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
   PID, rep_pla_pid, borrow_id, customer_id, receivable_hike, net_hike, net_hike_status,receivable_interest, 
    net_interest, repaid_capital, repaid_interest, capital, remaining_capital, pay_rate, 
    pay_amount, management_cost, receipt_status, expireactual_time, expire_time, late_fee, 
    late_fee_calculate_time, pay_type, pay_amount_time, plan_index, repaid_time, interest, 
    increase_interest, interest_type, status, create_user, create_time, last_update_user, 
    last_update_time, rec_pla_desc, version,is_vip,transfer_id,play_type,FUNC_GET_DICT_CONT_NAME('RECEIPT_STATUS',receipt_status) as receiptStatusName
  </sql>
  
  <sql id="BizReceiptPlanVO_Column_List" >
   brp.pid as pid,
	brp.rep_pla_pid as repPlaPid,
	brp.borrow_id as borrowId,
	brp.customer_id as customerId,
	brp.expire_time as expireTime,
	bb.borrow_code as borrowCode,
	bb.borrow_name as borrowName,
	bb.borrow_type as borrowType,
	brp.plan_index as planIndex,
	bb.bor_deadline as borDeadline,
	bb.is_equitable_assignment as isEquitableAssignment,
	IFNULL(brp.capital, 0) + IFNULL(brp.net_hike,0) + IFNULL(brp.net_interest	,0) + IFNULL(brp.late_fee,0) as principalAndInterest,
	brp.capital as capital,
	IFNULL(brp.net_interest,0) as interest,
	IFNULL(brp.net_hike,0) as netHike,
	brp.late_fee as lateFee,
	DATEDIFF(
		DATE(IFNULL(brp.expireactual_time,now())),
		DATE(brp.expire_time)
	) AS lateFeeDate,
	DATEDIFF(
		DATE(brp.expire_time),
		DATE(now())
	) AS returnedDate,
	brp.receipt_status as receiptStatus,
	FUNC_GET_DICT_CONT_NAME('RECEIPT_STATUS',brp.receipt_status) as receiptStatusName,
	brp.rec_pla_desc as recPlaDesc
  </sql>
  
  <sql id="BizReceiptPlanInfoVO_Column_List">
 			brp.PID as pid,
			bb.PID as borrowId,
			cc.PID as customerId,
			bb.borrow_code as borrowCode,
			bb.borrow_name as borrowName,
			cc.customer_name as customerName,
			cc.phone_no as phoneNo,
			brp.plan_index as planIndex,
			bb.bor_deadline as borDeadline,
			brp.expire_time as expireTime,
			bb.repayment_type as repaymentType,
			FUNC_GET_DICT_CONT_NAME('REPAYMENT_TYPE',bb.repayment_type) as repaymentTypeName,
			(IFNULL(brp.capital, 0) + IFNULL(brp.net_hike, 0) + IFNULL(brp.net_interest, 0) + IFNULL(brp.late_fee, 0)) as benXi,
			IFNULL(brp.capital, 0) as capital,
			IFNULL(brp.net_interest, 0) as liXi,
			IFNULL(brp.net_hike, 0) as jiaXi,
			IFNULL(brp.late_fee, 0) as lateFee,
			(CASE brp.expireactual_time
				WHEN brp.expireactual_time is null THEN null 
			  ELSE
					DATEDIFF(
						brp.expireactual_time,
						brp.expire_time
					)
			END) as lateDay,
			 (SELECT brt.transfer_code FROM t_biz_receipt_transfer brt where brt.PID = brp.transfer_id ) as transferCode,
			brp.transfer_id as transferId,
			brp.rec_pla_desc as recPlaDesc,
			brp.receipt_status as receiptStatus,
			FUNC_GET_DICT_CONT_NAME('RECEIPT_STATUS',brp.receipt_status) as receiptStatusName
  </sql>
  
  <sql id="temp_Column_List">
 			t.pid,
			t.borrowId,
			t.customerId,
			t.borrowCode,
			t.borrowName,
			t.customerName,
			t.phoneNo,
			t.planIndex,
			t.borDeadline,
			t.expireTime,
			t.repaymentType,
			t.repaymentTypeName,
			t.benXi,
			t.capital,
			t.liXi,
			t.lateFee,
			t.lateDay,
			t.transferCode,
			t.transferId,
			t.recPlaDesc,
			t.receiptStatus,
			t.receiptStatusName
  </sql>
<!--   客户待收查询 -->
  <sql id="temp_Column_List1">
	<!--回款日期 -->
	brp.expire_time expire_time,
	<!--应收总额  本金+利息 -->
  SUM(brp.capital+brp.receivable_interest) duein_TotalValue,
	<!--本金 -->
  brp.capital capital,
	<!--利息 -->
  brp.receivable_interest receivable_interest,
	<!--借款人 -->
  tcc.customer_name customer_id,
	<!--借款编号 -->
  (SELECT bb.borrow_code from t_biz_borrow bb where bb.PID=brp.borrow_id) borrow_id,
	<!--期次 -->
  brp.plan_index plan_index,
	<!--备注 -->
  brp.rec_pla_desc rec_pla_desc
  </sql>
  
  <sql id="BizReceiptWhere" >
  	<if test="map.borrowCode != null and map.borrowCode != ''" >
        and bb.borrow_code = #{map.borrowCode,jdbcType=VARCHAR}
      </if>
      <if test="map.borrowName != null and map.borrowName != ''" >
        and bb.borrow_name like concat('%',#{map.borrowName,jdbcType=VARCHAR},'%' )
      </if>
      <if test="map.customerName != null and map.customerName !=''" >
        and cc.customer_name like concat('%',#{map.customerName,jdbcType=VARCHAR},'%' )
      </if>
        
      <if test="map.receiptStatus != null  and map.receiptStatus !=''" >
        and brp.receipt_status = #{map.receiptStatus,jdbcType=VARCHAR}
      </if>
     
      <if test="map.startExpireTime != null and map.startExpireTime !=''" >
        and DATE_FORMAT(brp.expire_time, '%Y-%m-%d') <![CDATA[>=]]> DATE_FORMAT(#{map.startExpireTime,jdbcType=VARCHAR}, '%Y-%m-%d')
      </if>
		
      <if test="map.endExpireTime != null and map.endExpireTime !=''" >
        and DATE_FORMAT(brp.expire_time, '%Y-%m-%d') <![CDATA[<=]]> DATE_FORMAT(#{map.endExpireTime,jdbcType=VARCHAR}, '%Y-%m-%d')
      </if>
      
      <if test="map.startExpireTime2 != null and map.startExpireTime2 !='' and map.endExpireTime2 != null and map.endExpireTime2 !=''" >
        <if test="(map.endExpireTime != null and map.endExpireTime !='') or (map.startExpireTime != null and map.startExpireTime !='') " >
        	or
        	 (
        	DATE_FORMAT(brp.expire_time, '%Y-%m-%d') <![CDATA[>=]]> DATE_FORMAT(#{map.startExpireTime2,jdbcType=VARCHAR}, '%Y-%m-%d')
     
        	and DATE_FORMAT(brp.expire_time, '%Y-%m-%d') <![CDATA[<=]]> DATE_FORMAT(#{map.endExpireTime2,jdbcType=VARCHAR}, '%Y-%m-%d')
        )
        </if>
        <if test="(map.endExpireTime == null or map.endExpireTime =='') and (map.startExpireTime == null or map.startExpireTime =='')" >
        	and
        	 (
        	DATE_FORMAT(brp.expire_time, '%Y-%m-%d') <![CDATA[>=]]> DATE_FORMAT(#{map.startExpireTime2,jdbcType=VARCHAR}, '%Y-%m-%d')
     
        	and DATE_FORMAT(brp.expire_time, '%Y-%m-%d') <![CDATA[<=]]> DATE_FORMAT(#{map.endExpireTime2,jdbcType=VARCHAR}, '%Y-%m-%d')
        )
        </if>
        
      </if>
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from t_biz_receipt_plan
    where PID = #{pid,jdbcType=VARCHAR} 
  </select>
  <select id="findInvestList" resultMap="BaseResultMapInvest" parameterType="java.lang.String" >
	  SELECT
		(
			SELECT
				cc.customer_name
			FROM
				t_cust_customer cc
			WHERE
				cc.pid = brp.customer_id
		) AS `name`,
		SUM(brp.capital) as money,
		(
			SELECT
				bb.borrow_rate
			FROM
				t_biz_borrow bb
			WHERE
				bb.pid = #{borrowId,jdbcType=VARCHAR}
				
		) as yearRate,
		SUM(brp.capital) as capital,
		SUM(brp.net_hike) as interest,
		SUM(brp.capital + brp.net_hike) as totalMoney
	FROM
		t_biz_receipt_plan brp
	WHERE
		brp.borrow_id = #{borrowId,jdbcType=VARCHAR}
		<if test="userId !=null and userId !=''">
		and brp.customer_id = #{userId,jdbcType=VARCHAR}
	</if>
	GROUP BY
		brp.customer_id
  </select>
  <select id="findListByUser" resultMap="BaseResultMap" >
    select 
    <include refid="Base_Column_List" />
    from t_biz_receipt_plan brp
    where brp.customer_id = #{userId,jdbcType=VARCHAR} 
    	  AND brp.borrow_id = #{borrowId,jdbcType=VARCHAR}
     	  AND brp.play_type = #{playType,jdbcType=VARCHAR}
     	  <if test="transferId!=null and transferId!=''">
    	 	 AND brp.transfer_id = #{transferId,jdbcType=VARCHAR}
    	  </if>
    ORDER BY brp.expire_time ASC
  </select>
  
  <!-- 获取债权转让收款计划 -->
  <select id="findListByTransfer" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from t_biz_receipt_plan
    where transfer_id = #{transferId,jdbcType=VARCHAR} and play_type = #{playType,jdbcType=VARCHAR}
    ORDER BY expire_time ASC
  </select>
  <select id="findListByRepaymentId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from t_biz_receipt_plan
    where rep_pla_pid = #{rpmId,jdbcType=VARCHAR}
  </select>
  <select id="findListByNetHikeStatus" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from t_biz_receipt_plan
    where expire_time <![CDATA[ <= ]]> #{time,jdbcType=VARCHAR} AND net_hike_status = #{netHikeStatus,jdbcType=VARCHAR}
  </select>
  
  <select id="findValidByRepaymentId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from t_biz_receipt_plan
    where rep_pla_pid = #{rpmId,jdbcType=VARCHAR} and ( receipt_status = 1 or receipt_status = 2 or receipt_status = 3 ) 
  </select>
  
  <select id="sumBenJin" resultType="DECIMAL" parameterType="java.lang.String" >
    select 
  		sum(capital)
    from t_biz_receipt_plan
    where borrow_id = #{borrowId,jdbcType=VARCHAR}  and  customer_id = #{customerId,jdbcType=VARCHAR}
  </select>
  <!--  根据还款计划，获取非vip的收款计划集合 -->
  <select id="findListByRepaymentNotVip" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from t_biz_receipt_plan
    where rep_pla_pid = #{repaymentId,jdbcType=VARCHAR} and (is_vip != 1 or is_vip is null) AND receipt_status = #{bizReceiptplanStatus,jdbcType=VARCHAR}
  </select>
  <select id="sumBenXi" resultType="DECIMAL" parameterType="java.lang.String" >
    select 
  	IFNULL(brp.capital, 0) + IFNULL(brp.net_hike, 0) + IFNULL(brp.net_interest, 0) + IFNULL(brp.late_fee, 0)
    from t_biz_receipt_plan brp
    where PID = #{pid,jdbcType=VARCHAR} 
  </select>
  
  
  <!-- 债权转让详情 -->
  <select id="findReceiptPlanById" resultMap="BizReceiptPlanVOResultMap" >
	   	SELECT
			 <include refid="BizReceiptPlanVO_Column_List" />
		FROM
			t_biz_receipt_plan brp
		LEFT JOIN t_biz_borrow bb ON brp.borrow_id = bb.PID
		LEFT JOIN t_cust_customer cc ON brp.customer_id = cc.PID
		WHERE 
			brp.PID = #{vos.pid,jdbcType=VARCHAR}
			AND	brp.customer_id = #{vos.customerId,jdbcType=VARCHAR}
		
  </select>
  
  
  <!-- 用户标的待收本息 -->
  <select id="getSurpAmount" resultType="DECIMAL"  parameterType="java.lang.String">
		SELECT
			SUM(
				IFNULL(brp.capital, 0) + IFNULL(brp.net_hike, 0) + IFNULL(brp.increase_interest, 0) + IFNULL(brp.late_fee, 0)
			) AS surpAmount
		FROM
			t_biz_receipt_plan brp
		WHERE
			brp.receipt_status IN (1, 2)
		AND brp.customer_id = #{userId,jdbcType=VARCHAR}
		AND brp.borrow_id = #{borrowId,jdbcType=VARCHAR}
  </select>
  
  <!-- 根据收款状态求vip的总利息 -->
  <select id="sumVipAmount" resultType="DECIMAL"  parameterType="java.lang.String">
		SELECT
			SUM(
				IFNULL(brp.net_interest, 0)
			) AS vipAmount
		FROM
			t_biz_receipt_plan brp
		WHERE
		  brp.rep_pla_pid = #{repaymentPid,jdbcType=VARCHAR}	
		  AND brp.receipt_status = #{bizReceiptplanStatus,jdbcType=VARCHAR}
		  AND brp.is_vip = 1
  </select>
  
  <!-- 用户标的已收本息 -->
  <select id="getAlreadyAmount" resultType="DECIMAL" parameterType="java.lang.String" >
	   	SELECT
			SUM(
				IFNULL(brp.capital, 0) + IFNULL(brp.net_hike, 0) + IFNULL(brp.increase_interest, 0) + IFNULL(brp.late_fee, 0)
			) AS alreadyAmount
		FROM
			t_biz_receipt_plan brp
		WHERE
			brp.receipt_status IN (5, 6)
		AND brp.customer_id = #{userId,jdbcType=VARCHAR}
		AND brp.borrow_id = #{borrowId,jdbcType=VARCHAR}
  </select>
  
  <!-- 用户标的本息，不含加息 -->
  <select id="sumCapitalAndInterest" resultType="DECIMAL" parameterType="java.lang.String" >
	   	SELECT
			SUM(IFNULL(brp.capital, 0) + IFNULL(brp.increase_interest, 0) + IFNULL(brp.late_fee, 0))
			AS alreadyAmount
		FROM
			t_biz_receipt_plan brp
		WHERE
			brp.receipt_status IN (5, 6)
		AND brp.customer_id = #{userId,jdbcType=VARCHAR}
		AND brp.borrow_id = #{borrowId,jdbcType=VARCHAR}
  </select>
  <!-- 用户标的加息 -->
  <select id="sumNetHike" resultType="DECIMAL" parameterType="java.lang.String" >
	   	SELECT
			SUM(IFNULL(brp.net_hike, 0)) 
			AS alreadyAmount
		FROM
			t_biz_receipt_plan brp
		WHERE
			brp.receipt_status IN (5, 6)
		AND brp.customer_id = #{userId,jdbcType=VARCHAR}
		AND brp.borrow_id = #{borrowId,jdbcType=VARCHAR}
  </select>
  
  <select id="findList" resultMap="BizReceiptPlanVOResultMap">
	 SELECT
		 <include refid="BizReceiptPlanVO_Column_List" />
	FROM
		t_biz_receipt_plan brp
	LEFT JOIN t_biz_borrow bb ON brp.borrow_id = bb.PID
	LEFT JOIN t_cust_customer cc ON brp.customer_id = cc.PID
	WHERE brp.customer_id = #{vos.customerId,jdbcType=VARCHAR}
	
	<if test="vos.startExpireTime != null and vos.startExpireTime != '' ">
		AND DATE_FORMAT(brp.expire_time,'%Y-%m-%d') <![CDATA[ >= ]]> #{vos.startExpireTime,jdbcType=VARCHAR}
	</if>
	<if test="vos.endExpireTime != null and vos.endExpireTime != '' ">
		AND DATE_FORMAT(brp.expire_time,'%Y-%m-%d') <![CDATA[ <= ]]> #{vos.endExpireTime,jdbcType=VARCHAR}
	</if>
	<if test="vos.receiptStatus != null and vos.receiptStatus != '' ">
		AND brp.receipt_status = #{vos.receiptStatus,jdbcType=VARCHAR}
	</if>
	<if test="vos.borrowId != null and vos.borrowId != '' ">
		AND brp.borrow_id = #{vos.borrowId,jdbcType=VARCHAR}
	</if>
	ORDER BY bb.borrow_code DESC,brp.expire_time 
	<if test="pageIndex!=null and pageSize!=null">
		LIMIT #{pageIndex,jdbcType=INTEGER} ,#{pageSize,jdbcType=INTEGER} 
	</if>
  </select>
  <select id="searchAllPage" resultMap="BizReceiptPlanInfoVOResultMap">
		SELECT
			<include refid="BizReceiptPlanInfoVO_Column_List"></include>
		FROM
			t_biz_receipt_plan brp
		LEFT JOIN t_biz_borrow bb ON brp.borrow_id = bb.PID
		LEFT JOIN t_cust_customer cc ON brp.customer_id = cc.PID
		WHERE 1 = 1
		<include refid="BizReceiptWhere"></include>
		
  </select>
  <select id="sumAllPage" resultType="DECIMAL">
		SELECT
			SUM((IFNULL(brp.capital, 0) + IFNULL(brp.net_hike, 0) + IFNULL(brp.net_interest, 0) + IFNULL(brp.late_fee, 0))) as benXi
		FROM
			t_biz_receipt_plan brp
		LEFT JOIN t_biz_borrow bb ON brp.borrow_id = bb.PID
		LEFT JOIN t_cust_customer cc ON brp.customer_id = cc.PID
		WHERE 1 = 1
		<include refid="BizReceiptWhere"></include>
		ORDER BY brp.create_time DESC
		
  </select>
  <select id="findTotalCount" resultType="INTEGER">
	 SELECT
		COUNT(brp.PID)
	FROM
		t_biz_receipt_plan brp
	LEFT JOIN t_biz_borrow bb ON brp.borrow_id = bb.PID
	LEFT JOIN t_cust_customer cc ON brp.customer_id = cc.PID
	WHERE brp.customer_id = #{vos.customerId,jdbcType=VARCHAR}
	
	<if test="vos.startExpireTime != null and vos.startExpireTime != '' ">
		AND DATE_FORMAT(brp.expire_time,'%Y-%m-%d') <![CDATA[ >= ]]> #{vos.startExpireTime,jdbcType=VARCHAR}
	</if>
	<if test="vos.endExpireTime != null and vos.endExpireTime != '' ">
		AND DATE_FORMAT(brp.expire_time,'%Y-%m-%d') <![CDATA[ <= ]]> #{vos.endExpireTime,jdbcType=VARCHAR}
	</if>
	<if test="vos.receiptStatus != null and vos.receiptStatus != '' ">
		AND brp.receipt_status = #{vos.receiptStatus,jdbcType=VARCHAR}
	</if>
	<if test="vos.borrowId != null and vos.borrowId != '' ">
		AND brp.borrow_id = #{vos.borrowId,jdbcType=VARCHAR}
	</if>
  </select>
  
  
  
    <!-- 导出查询 -->
  <select id="selectBizReceiptPlanInfoVOEom" resultMap="BizReceiptPlanInfoVOResultMap">
    select 
    	<include refid="temp_Column_List" />
    from (
    	select 
    		(@rown := @rown + 1) rowns,
    		<include refid="temp_Column_List" />
    	from (
	  		SELECT
	  			<include refid="BizReceiptPlanInfoVO_Column_List"></include>
	  		FROM
				t_biz_receipt_plan brp
				LEFT JOIN t_biz_borrow bb ON brp.borrow_id = bb.PID
				LEFT JOIN t_cust_customer cc ON brp.customer_id = cc.PID
				ORDER BY brp.create_time DESC
			) t ,
			(SELECT @rown := 0) b
	) t where 1=1 
  		<include refid="BizReceiptWhere"></include>
		<include refid="export_query_sql"></include>
		
  </select>
   <!-- 导出查询条件 -->
  <sql id="export_query_sql">
  	<if test="expm.exportSet != null and expm.exportSet != ''">
  		<!-- 选择情况一 -->
  		<if test="expm.exportSet == 1 and expm.checkrows != null">
  			AND t.pid IN 
  			<foreach collection="expm.checkrows" index="index" item="item" open="(" separator="," close=")">  
		        #{item,jdbcType=VARCHAR} 
		    </foreach>  
  		</if>
  		
  		<!-- 选择情况二 -->
  		<if test="expm.exportSet == 2 and expm.startCheckpage != null and expm.endCheckpage != null">
  			limit #{expm.startCheckpage,jdbcType=INTEGER},#{expm.endCheckpage,jdbcType=INTEGER}
  		</if>
  		
  		<!-- 选择情况三 -->
  		<if test="expm.exportSet == 3 and expm.startCheckrecords != null and expm.endCheckrecords != null">
			AND t.rowns BETWEEN #{expm.startCheckrecords,jdbcType=INTEGER}
				AND #{expm.endCheckrecords,jdbcType=INTEGER} 
  		</if>
  	</if>
  </sql>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from t_biz_receipt_plan
    where PID = #{pid,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.yscf.core.model.business.BizReceiptPlan" >
    insert into t_biz_receipt_plan (PID, rep_pla_pid, borrow_id, 
      customer_id, receivable_hike, net_hike, net_hike_status,
      receivable_interest, net_interest, repaid_capital, 
      repaid_interest, capital, remaining_capital, 
      pay_rate, pay_amount, management_cost, 
      receipt_status, expireactual_time, expire_time, 
      late_fee, late_fee_calculate_time, pay_type, 
      pay_amount_time, plan_index, repaid_time, 
      interest, increase_interest, interest_type, 
      status, create_user, create_time, 
      last_update_user, last_update_time, rec_pla_desc, 
      version,is_vip,transfer_id,play_type)
    values (#{pid,jdbcType=VARCHAR}, #{repPlaPid,jdbcType=VARCHAR}, #{borrowId,jdbcType=VARCHAR}, 
      #{customerId,jdbcType=VARCHAR}, #{receivableHike,jdbcType=DECIMAL}, #{netHike,jdbcType=DECIMAL},  #{netHikeStatus,jdbcType=VARCHAR}, 
      #{receivableInterest,jdbcType=DECIMAL}, #{netInterest,jdbcType=DECIMAL}, #{repaidCapital,jdbcType=DECIMAL}, 
      #{repaidInterest,jdbcType=DECIMAL}, #{capital,jdbcType=DECIMAL}, #{remainingCapital,jdbcType=DECIMAL}, 
      #{payRate,jdbcType=DECIMAL}, #{payAmount,jdbcType=DECIMAL}, #{managementCost,jdbcType=DECIMAL}, 
      #{receiptStatus,jdbcType=VARCHAR}, #{expireactualTime,jdbcType=TIMESTAMP}, #{expireTime,jdbcType=TIMESTAMP}, 
      #{lateFee,jdbcType=DECIMAL}, #{lateFeeCalculateTime,jdbcType=TIMESTAMP}, #{payType,jdbcType=VARCHAR}, 
      #{payAmountTime,jdbcType=TIMESTAMP}, #{planIndex,jdbcType=VARCHAR}, #{repaidTime,jdbcType=TIMESTAMP}, 
      #{interest,jdbcType=DECIMAL}, #{increaseInterest,jdbcType=DECIMAL}, #{interestType,jdbcType=VARCHAR}, 
      #{status,jdbcType=VARCHAR}, #{createUser,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, 
      #{lastUpdateUser,jdbcType=VARCHAR}, #{lastUpdateTime,jdbcType=TIMESTAMP}, #{recPlaDesc,jdbcType=VARCHAR}, 
      '1',#{isVip,jdbcType=VARCHAR},#{transferId,jdbcType=VARCHAR},#{playType,jdbcType=VARCHAR})
  </insert>
  
  <insert id="insertBatch" parameterType="java.util.List" >
    insert into t_biz_receipt_plan (PID, rep_pla_pid, borrow_id, 
      customer_id, receivable_hike, net_hike, net_hike_status,
      receivable_interest, net_interest, repaid_capital, 
      repaid_interest, capital, remaining_capital, 
      pay_rate, pay_amount, management_cost, 
      receipt_status, expireactual_time, expire_time, 
      late_fee, late_fee_calculate_time, pay_type, 
      pay_amount_time, plan_index, repaid_time, 
      interest, increase_interest, interest_type, 
      status, create_user, create_time, 
      last_update_user, last_update_time, rec_pla_desc, 
      version,is_vip,transfer_id,play_type)
    values
     <foreach collection="list" item="item"  separator=","> (#{item.pid,jdbcType=VARCHAR}, #{item.repPlaPid,jdbcType=VARCHAR}, #{item.borrowId,jdbcType=VARCHAR}, 
	      #{item.customerId,jdbcType=VARCHAR}, #{item.receivableHike,jdbcType=DECIMAL}, #{item.netHike,jdbcType=DECIMAL}, #{item.netHikeStatus,jdbcType=VARCHAR},
	      #{item.receivableInterest,jdbcType=DECIMAL}, #{item.netInterest,jdbcType=DECIMAL}, #{item.repaidCapital,jdbcType=DECIMAL}, 
	      #{item.repaidInterest,jdbcType=DECIMAL}, #{item.capital,jdbcType=DECIMAL}, #{item.remainingCapital,jdbcType=DECIMAL}, 
	      #{item.payRate,jdbcType=DECIMAL}, #{item.payAmount,jdbcType=DECIMAL}, #{item.managementCost,jdbcType=DECIMAL}, 
	      #{item.receiptStatus,jdbcType=VARCHAR}, #{item.expireactualTime,jdbcType=TIMESTAMP}, #{item.expireTime,jdbcType=TIMESTAMP}, 
	      #{item.lateFee,jdbcType=DECIMAL}, #{item.lateFeeCalculateTime,jdbcType=TIMESTAMP}, #{item.payType,jdbcType=VARCHAR}, 
	      #{item.payAmountTime,jdbcType=TIMESTAMP}, #{item.planIndex,jdbcType=VARCHAR}, #{item.repaidTime,jdbcType=TIMESTAMP}, 
	      #{item.interest,jdbcType=DECIMAL}, #{item.increaseInterest,jdbcType=DECIMAL}, #{item.interestType,jdbcType=VARCHAR}, 
	      #{item.status,jdbcType=VARCHAR}, #{item.createUser,jdbcType=VARCHAR}, #{item.createTime,jdbcType=TIMESTAMP}, 
	      #{item.lastUpdateUser,jdbcType=VARCHAR}, #{item.lastUpdateTime,jdbcType=TIMESTAMP}, #{item.recPlaDesc,jdbcType=VARCHAR}, 
	      '1',#{item.isVip,jdbcType=VARCHAR},#{item.transferId,jdbcType=VARCHAR},#{item.playType,jdbcType=VARCHAR})
      </foreach>
     
  
      
      
  </insert>
  <insert id="insertSelective" parameterType="com.yscf.core.model.business.BizReceiptPlan" >
    insert into t_biz_receipt_plan
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="pid != null" >
        PID,
      </if>
      <if test="repPlaPid != null" >
        rep_pla_pid,
      </if>
      <if test="borrowId != null" >
        borrow_id,
      </if>
      <if test="customerId != null" >
        customer_id,
      </if>
      <if test="receivableHike != null" >
        receivable_hike,
      </if>
      <if test="netHike != null" >
        net_hike,
      </if>
      <if test="netHikeStatus != null" >
        net_hike_status,
      </if>
      <if test="receivableInterest != null" >
        receivable_interest,
      </if>
      <if test="netInterest != null" >
        net_interest,
      </if>
      <if test="repaidCapital != null" >
        repaid_capital,
      </if>
      <if test="repaidInterest != null" >
        repaid_interest,
      </if>
      <if test="capital != null" >
        capital,
      </if>
      <if test="remainingCapital != null" >
        remaining_capital,
      </if>
      <if test="payRate != null" >
        pay_rate,
      </if>
      <if test="payAmount != null" >
        pay_amount,
      </if>
      <if test="managementCost != null" >
        management_cost,
      </if>
      <if test="receiptStatus != null" >
        receipt_status,
      </if>
      <if test="expireactualTime != null" >
        expireactual_time,
      </if>
      <if test="expireTime != null" >
        expire_time,
      </if>
      <if test="lateFee != null" >
        late_fee,
      </if>
      <if test="lateFeeCalculateTime != null" >
        late_fee_calculate_time,
      </if>
      <if test="payType != null" >
        pay_type,
      </if>
      <if test="payAmountTime != null" >
        pay_amount_time,
      </if>
      <if test="planIndex != null" >
        plan_index,
      </if>
      <if test="repaidTime != null" >
        repaid_time,
      </if>
      <if test="interest != null" >
        interest,
      </if>
      <if test="increaseInterest != null" >
        increase_interest,
      </if>
      <if test="interestType != null" >
        interest_type,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="createUser != null" >
        create_user,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="lastUpdateUser != null" >
        last_update_user,
      </if>
      <if test="lastUpdateTime != null" >
        last_update_time,
      </if>
      <if test="recPlaDesc != null" >
        rec_pla_desc,
      </if>
      <if test="version != null" >
        version,
      </if>
      <if test="isVip != null" >
        is_vip,
      </if>
      <if test="transferId != null" >
        transfer_id,
      </if>
      <if test="playType != null" >
        play_type,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="pid != null" >
        #{pid,jdbcType=VARCHAR},
      </if>
      <if test="repPlaPid != null" >
        #{repPlaPid,jdbcType=VARCHAR},
      </if>
      <if test="borrowId != null" >
        #{borrowId,jdbcType=VARCHAR},
      </if>
      <if test="customerId != null" >
        #{customerId,jdbcType=VARCHAR},
      </if>
      <if test="receivableHike != null" >
        #{receivableHike,jdbcType=DECIMAL},
      </if>
      <if test="netHike != null" >
        #{netHike,jdbcType=DECIMAL},
      </if>
      <if test="netHikeStatus != null" >
        #{netHikeStatus,jdbcType=VARCHAR},
      </if>
      <if test="receivableInterest != null" >
        #{receivableInterest,jdbcType=DECIMAL},
      </if>
      <if test="netInterest != null" >
        #{netInterest,jdbcType=DECIMAL},
      </if>
      <if test="repaidCapital != null" >
        #{repaidCapital,jdbcType=DECIMAL},
      </if>
      <if test="repaidInterest != null" >
        #{repaidInterest,jdbcType=DECIMAL},
      </if>
      <if test="capital != null" >
        #{capital,jdbcType=DECIMAL},
      </if>
      <if test="remainingCapital != null" >
        #{remainingCapital,jdbcType=DECIMAL},
      </if>
      <if test="payRate != null" >
        #{payRate,jdbcType=DECIMAL},
      </if>
      <if test="payAmount != null" >
        #{payAmount,jdbcType=DECIMAL},
      </if>
      <if test="managementCost != null" >
        #{managementCost,jdbcType=DECIMAL},
      </if>
      <if test="receiptStatus != null" >
        #{receiptStatus,jdbcType=VARCHAR},
      </if>
      <if test="expireactualTime != null" >
        #{expireactualTime,jdbcType=TIMESTAMP},
      </if>
      <if test="expireTime != null" >
        #{expireTime,jdbcType=TIMESTAMP},
      </if>
      <if test="lateFee != null" >
        #{lateFee,jdbcType=DECIMAL},
      </if>
      <if test="lateFeeCalculateTime != null" >
        #{lateFeeCalculateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="payType != null" >
        #{payType,jdbcType=VARCHAR},
      </if>
      <if test="payAmountTime != null" >
        #{payAmountTime,jdbcType=TIMESTAMP},
      </if>
      <if test="planIndex != null" >
        #{planIndex,jdbcType=VARCHAR},
      </if>
      <if test="repaidTime != null" >
        #{repaidTime,jdbcType=TIMESTAMP},
      </if>
      <if test="interest != null" >
        #{interest,jdbcType=DECIMAL},
      </if>
      <if test="increaseInterest != null" >
        #{increaseInterest,jdbcType=DECIMAL},
      </if>
      <if test="interestType != null" >
        #{interestType,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="createUser != null" >
        #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="lastUpdateUser != null" >
        #{lastUpdateUser,jdbcType=VARCHAR},
      </if>
      <if test="lastUpdateTime != null" >
        #{lastUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="recPlaDesc != null" >
        #{recPlaDesc,jdbcType=VARCHAR},
      </if>
      <if test="version != null" >
        #{version,jdbcType=VARCHAR},
      </if>
      <if test="isVip!= null" >
        #{isVip,jdbcType=VARCHAR},
      </if>
      <if test="transferId!= null" >
        #{transferId,jdbcType=VARCHAR},
      </if>
      <if test="playType!= null" >
        #{playType,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.yscf.core.model.business.BizReceiptPlan" >
   update t_biz_receipt_plan
    <set >
      <if test="repPlaPid != null" >
        rep_pla_pid = #{repPlaPid,jdbcType=VARCHAR},
      </if>
      <if test="borrowId != null" >
        borrow_id = #{borrowId,jdbcType=VARCHAR},
      </if>
      <if test="customerId != null" >
        customer_id = #{customerId,jdbcType=VARCHAR},
      </if>
      <if test="receivableHike != null" >
        receivable_hike = #{receivableHike,jdbcType=DECIMAL},
      </if>
      <if test="netHike != null" >
        net_hike = #{netHike,jdbcType=DECIMAL},
      </if>
      <if test="netHikeStatus != null" >
        net_hike_status = #{netHikeStatus,jdbcType=VARCHAR},
      </if>
      <if test="receivableInterest != null" >
        receivable_interest = #{receivableInterest,jdbcType=DECIMAL},
      </if>
      <if test="netInterest != null" >
        net_interest = #{netInterest,jdbcType=DECIMAL},
      </if>
      <if test="repaidCapital != null" >
        repaid_capital = #{repaidCapital,jdbcType=DECIMAL},
      </if>
      <if test="repaidInterest != null" >
        repaid_interest = #{repaidInterest,jdbcType=DECIMAL},
      </if>
      <if test="capital != null" >
        capital = #{capital,jdbcType=DECIMAL},
      </if>
      <if test="remainingCapital != null" >
        remaining_capital = #{remainingCapital,jdbcType=DECIMAL},
      </if>
      <if test="payRate != null" >
        pay_rate = #{payRate,jdbcType=DECIMAL},
      </if>
      <if test="payAmount != null" >
        pay_amount = #{payAmount,jdbcType=DECIMAL},
      </if>
      <if test="managementCost != null" >
        management_cost = #{managementCost,jdbcType=DECIMAL},
      </if>
      <if test="receiptStatus != null" >
        receipt_status = #{receiptStatus,jdbcType=VARCHAR},
      </if>
      <if test="expireactualTime != null" >
        expireactual_time = #{expireactualTime,jdbcType=TIMESTAMP},
      </if>
      <if test="expireTime != null" >
        expire_time = #{expireTime,jdbcType=TIMESTAMP},
      </if>
      <if test="lateFee != null" >
        late_fee = #{lateFee,jdbcType=DECIMAL},
      </if>
      <if test="lateFeeCalculateTime != null" >
        late_fee_calculate_time = #{lateFeeCalculateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="payType != null" >
        pay_type = #{payType,jdbcType=VARCHAR},
      </if>
      <if test="payAmountTime != null" >
        pay_amount_time = #{payAmountTime,jdbcType=TIMESTAMP},
      </if>
      <if test="planIndex != null" >
        plan_index = #{planIndex,jdbcType=VARCHAR},
      </if>
      <if test="repaidTime != null" >
        repaid_time = #{repaidTime,jdbcType=TIMESTAMP},
      </if>
      <if test="interest != null" >
        interest = #{interest,jdbcType=DECIMAL},
      </if>
      <if test="increaseInterest != null" >
        increase_interest = #{increaseInterest,jdbcType=DECIMAL},
      </if>
      <if test="interestType != null" >
        interest_type = #{interestType,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="createUser != null" >
        create_user = #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="lastUpdateUser != null" >
        last_update_user = #{lastUpdateUser,jdbcType=VARCHAR},
      </if>
      <if test="lastUpdateTime != null" >
        last_update_time = #{lastUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="recPlaDesc != null" >
        rec_pla_desc = #{recPlaDesc,jdbcType=VARCHAR},
      </if>
      <if test="version != null" >
        version = version + 1,
      </if>
      <if test="isVip != null" >
        is_vip = #{isVip,jdbcType=VARCHAR},
      </if>
      <if test="transferId != null" >
        transfer_id = #{transferId,jdbcType=VARCHAR},
      </if>
      <if test="playType != null" >
        play_type = #{playType,jdbcType=VARCHAR},
      </if>
    </set>
    where PID = #{pid,jdbcType=VARCHAR}
      <if test="version != null and version!='' " >
       and version = #{version,jdbcType=VARCHAR}
      </if>
  </update>
  <update id="updateByPrimaryKey" parameterType="com.yscf.core.model.business.BizReceiptPlan" >
     update t_biz_receipt_plan
    set rep_pla_pid = #{repPlaPid,jdbcType=VARCHAR},
      borrow_id = #{borrowId,jdbcType=VARCHAR},
      customer_id = #{customerId,jdbcType=VARCHAR},
      receivable_hike = #{receivableHike,jdbcType=DECIMAL},
      net_hike = #{netHike,jdbcType=DECIMAL},
      net_hike_status = #{netHikeStatus,jdbcType=VARCHAR},
      receivable_interest = #{receivableInterest,jdbcType=DECIMAL},
      net_interest = #{netInterest,jdbcType=DECIMAL},
      repaid_capital = #{repaidCapital,jdbcType=DECIMAL},
      repaid_interest = #{repaidInterest,jdbcType=DECIMAL},
      capital = #{capital,jdbcType=DECIMAL},
      remaining_capital = #{remainingCapital,jdbcType=DECIMAL},
      pay_rate = #{payRate,jdbcType=DECIMAL},
      pay_amount = #{payAmount,jdbcType=DECIMAL},
      management_cost = #{managementCost,jdbcType=DECIMAL},
      receipt_status = #{receiptStatus,jdbcType=VARCHAR},
      expireactual_time = #{expireactualTime,jdbcType=TIMESTAMP},
      expire_time = #{expireTime,jdbcType=TIMESTAMP},
      late_fee = #{lateFee,jdbcType=DECIMAL},
      late_fee_calculate_time = #{lateFeeCalculateTime,jdbcType=TIMESTAMP},
      pay_type = #{payType,jdbcType=VARCHAR},
      pay_amount_time = #{payAmountTime,jdbcType=TIMESTAMP},
      plan_index = #{planIndex,jdbcType=VARCHAR},
      repaid_time = #{repaidTime,jdbcType=TIMESTAMP},
      interest = #{interest,jdbcType=DECIMAL},
      increase_interest = #{increaseInterest,jdbcType=DECIMAL},
      interest_type = #{interestType,jdbcType=VARCHAR},
      status = #{status,jdbcType=VARCHAR},
      create_user = #{createUser,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      last_update_user = #{lastUpdateUser,jdbcType=VARCHAR},
      last_update_time = #{lastUpdateTime,jdbcType=TIMESTAMP},
      rec_pla_desc = #{recPlaDesc,jdbcType=VARCHAR},
      version = version + 1,
      transfer_id = #{transferId,jdbcType=VARCHAR},
      is_vip = #{isVip,jdbcType=VARCHAR},
      play_type = #{playType,jdbcType=VARCHAR}
    where PID = #{pid,jdbcType=VARCHAR} and version = #{version,jdbcType=VARCHAR}
  </update>
  
  
  <update id="updateByTransfer" parameterType="com.yscf.core.model.business.BizReceiptPlan" >
     update t_biz_receipt_plan
     set receipt_status = #{bizReceiptplanStatus,jdbcType=VARCHAR},
     last_update_time = NOW()
     where transfer_id = #{transferId,jdbcType=VARCHAR} and play_type = #{investSrcType,jdbcType=VARCHAR} and receipt_status = 3
     
  </update>
  
  <!--批量修改转让中 -->
  <update id="updateTransfer">
   update t_biz_receipt_plan
 	set
      <if test="bizReceiptplanStatus != null" >
        receipt_status = #{bizReceiptplanStatus,jdbcType=VARCHAR},
      </if>
        last_update_time = NOW(),
      
      <if test="transferId != null" >
        transfer_id = #{transferId,jdbcType=VARCHAR},
      </if>
       version = version + 1
    where  borrow_id = #{borrowId,jdbcType=VARCHAR}
     and customer_id = #{userId,jdbcType=VARCHAR}
     and  receipt_status = '1'
      <if test="transferId2 != null" >
      and transfer_id = #{transferId2,jdbcType=VARCHAR}
     </if>
  </update>
  <!--将垫付的vip改成已结清-->
  <update id="updateStatusByVip">
   update t_biz_receipt_plan
 	set
		receipt_status = #{toStatus,jdbcType=VARCHAR}
    where  receipt_status = #{srcStatus,jdbcType=VARCHAR}
     and  is_vip = 1
     AND  rep_pla_pid = #{brpId,jdbcType=VARCHAR}
  </update>
  
  
  <!-- 提前还款批量修改 -->
  <update id="batchUpdateToPrepayment" parameterType="java.util.List">
  	<foreach collection="list" item="item" index="index" open="" close="" separator=";">
		update t_biz_receipt_plan
		<set>
			<if test="item.receiptStatus != null" >
				receipt_status = #{item.receiptStatus,jdbcType=DECIMAL}, 
			</if>
			<if test="item.repaidTime != null" >
				repaid_time = #{item.repaidTime,jdbcType=VARCHAR}, 
			</if>
			<if test="item.interest != null" >
				interest = #{item.interest,jdbcType=DECIMAL}, 
			</if>
			<if test="item.increaseInterest != null" >
				increase_interest = #{item.increaseInterest,jdbcType=DECIMAL}, 
			</if>
			<if test="item.receivableHike != null" >
				receivable_hike = #{item.receivableHike,jdbcType=DECIMAL}, 
			</if>
			<if test="item.netHike != null" >
				net_hike = #{item.netHike,jdbcType=DECIMAL}, 
			</if>
			<if test="item.netHikeStatus != null" >
				net_hike_status = #{item.netHikeStatus,jdbcType=VARCHAR}, 
			</if>
			<if test="item.receivableInterest != null" >
				receivable_interest = #{item.receivableInterest,jdbcType=DECIMAL}, 
			</if>
			<if test="item.netInterest != null" >
				net_interest = #{item.netInterest,jdbcType=DECIMAL}, 
			</if>
			<if test="item.remainingCapital != null" >
				remaining_capital = #{item.remainingCapital,jdbcType=DECIMAL},
			</if>
			<if test="item.lastUpdateUser != null" >
				last_update_user = #{item.lastUpdateUser,jdbcType=VARCHAR},
			</if>
		</set>
		where pid = #{item.pid,jdbcType=VARCHAR}
	</foreach>
  </update>
  
   <!--   客户待收明细查询 -->
   <select id="selectAllPage" resultMap="BaseResultMap" parameterType="com.yscf.core.model.business.BizReceiptPlan">
         select <include refid="temp_Column_List1"></include>
         from   t_biz_receipt_plan brp,
			    t_cust_customer tcc
		where   tcc.PID=brp.customer_id  
		and     tcc.pid =  #{bizReceiptPlan.customerId,jdbcType=VARCHAR}
   </select>
   
   <select id="getLastDeline" resultMap="BaseResultMap" parameterType="java.lang.String">
         select <include refid="Base_Column_List"></include>
         from   t_biz_receipt_plan  
         	where status = 1 
         	and borrow_id = #{borrowId,jdbcType=VARCHAR} 
         	and customer_id = #{customerId,jdbcType=VARCHAR} 
         	and plan_index = #{borDeadline,jdbcType=VARCHAR} 
         	and ( receipt_status = 1 or receipt_status = 2 or receipt_status = 3 ) 
   </select>
</mapper>